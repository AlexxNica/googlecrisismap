{% extends "base.html" %}

{% comment %}
Copyright 2012 Google Inc.  All Rights Reserved.

Licensed under the Apache License, Version 2.0 (the "License"); you may not
use this file except in compliance with the License.  You may obtain a copy
of the License at: http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distrib-
uted under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES
OR CONDITIONS OF ANY KIND, either express or implied.  See the License for
specific language governing permissions and limitations under the License.
{% endcomment %}

{% block content %}
<h2 class="cm-perms-heading">{{domain.name}}</h2>
<h3 class="cm-perms-subheading">Settings</h3>
<div class="cm-perms-domain-settings">
  <form method="post">
    <input type="hidden" name="form" value="domain-settings">
    <ul>
      <li>
        <span class="cm-perms-setting-label">Default label:</span>
        <span class="cm-perms-setting-value">
          <select name='default_label'>
            {% if domain.default_label not in labels and domain.default_label != 'empty' %}
              <option value="{{domain.default_label}}" selected>
                {{domain.default_label}} (does not exist)
               </option>
            {% endif %}
            {% for label in labels %}
              <option value="{{label}}"
                      {% if label == domain.default_label %}selected{% endif %}>
                {{label}}
              </option>
            {% endfor %}
            {% if 'empty' not in labels %}
              <option disabled>
              <option value="empty"
                      {% if domain.default_label == 'empty' %}selected {% endif %}>
                &lt;None&gt;
              </option>
            {% endif %}
          </select>
        </span>
      </li>
      <li>
        <span class="cm-perms-setting-label">Publisher owns their labels:</span>
        <span class="cm-perms-setting-value">
          <input type="checkbox" name="has_sticky_catalog_entries"
                 {{ domain.has_sticky_catalog_entries|yesno:"checked" }}>
        </span>
      </li>
      <li>
        <span class="cm-perms-setting-label">
          When a new map is created, people in this domain should:
        </span>
        <span class="cm-perms-setting-value">
          <select name="initial_domain_role">
            {% for choice in initial_domain_role_choices %}
              <option value={{choice.0}}
                      {% if domain.initial_domain_role == choice.0 %}selected {% endif %}>
                {{choice.1}}
              </option>
            {% endfor %}
          </select>
        </span>
      </li>
    </ul>
    <input type="submit" value="Save Settings" class="cm-button cm-submit">
  </form>
</div>

<h3 class="cm-perms-subheading">User Permissions</h3>
<div class="cm-perms-user-settings">
  <form method="post">
    <input type="hidden" name="form" value="user-permissions">
    <table title="Users" border=1>
      <tr>
        <th scope="col">User</th>
        {% for choice in user_permission_choices %}
          <th scope="col">{{choice.1}}</th>
        {% endfor %}
      </tr>
      {% for user in users %}
        <tr>
          <td class="cm-perms-subject">{{user.0}}</td>
          {% for choice in user_permission_choices %}
            <td>
              <input type="checkbox" name="{{user.0}}.{{choice.0}}"
                     {% if choice.0 in user.1 %}checked{% endif %}>
            </td>
          {% endfor %}
        </tr>
    {% endfor %}
    </table>
    <input type="submit" value="Save Permissions" class="cm-button cm-submit">
  </form>
</div>

<h3 class="cm-perms-subheading">Add new user</h3>
<div class="cm-perms-new-user-form">
  <form method="post">
    <input type="hidden" name="form" value="add-user">
    <p>User's email or domain name:
      <input type="text" name="new_email" label="Email">
    <p>Can create maps:
      <input type="checkbox" name="new_email.MAP_CREATOR" label="Map Creator">
    <p>Can edit the catalog:
      <input type="checkbox" name="new_email.CATALOG_EDITOR" label="Catalog Editor">
    <p>Can administer the domain:
      <input type="checkbox" name="new_email.DOMAIN_ADMIN" label="Domain Admin"><br>
    <p><input type="submit" value="Add User" class="cm-button cm-submit">
  </form>
</div>

{% if show_welcome %}
{# TODO(rew): This is largely cribbed from welcome.html; generalize that #}
{# template and include it here instead. #}
<div class="cm-popup" id="domain-welcome-popup" style="display:none">
  <form method="post" action="javascript:void(0);">
  <h2>Domain administration</h2>
  <div class="cm-section">
    <div class="cm-p">
      Google Crisis Map organizes maps under <b>domains</b> that identify the
      organization publishing them.  Your domain is {{domain.name}}.  From here,
      you can set various defaults for your domain, add new users, and manage
      the permissions those users have.
    </div>
    <div class="cm-p">
      <b>You are now the administrator of {{domain.name}} administrator</b>,
      which gives you access to this page.  You can add other
      administrators, but a domain should always have at least one
      administrator.
    </div>
    <div class="cm-button-area">
      <input type="submit" class="cm-submit cm-button" value="OK"
             onclick="hide($('domain-welcome-popup'))">
    </div>
  </form>
</div>
<script type="text/javascript" src="{{root}}/.static/popups.js"></script>
<script>showPopup($('domain-welcome-popup'))</script>
{% endif %}
{% endblock %}
