# Copyright 2012 Google Inc.  All Rights Reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License"); you may not
# use this file except in compliance with the License.  You may obtain a copy
# of the License at: http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software distrib-
# uted under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES
# OR CONDITIONS OF ANY KIND, either express or implied.  See the License for
# specific language governing permissions and limitations under the License.

application: crisislanding-hr
version: 1
runtime: python27
threadsafe: true
api_version: 1
libraries:
- name: django
  version: "1.3"
- name: PIL
  version: "latest"

# Enabling warmup requests gives us the option to configure idle instances,
# if we need to prepare for traffic spikes ahead of time.  For details, see:
# https://developers.google.com/appengine/docs/adminconsole/performancesettings
inbound_services:
- warmup

handlers:
- url: /crisismap/wms/query_layers
  script: wmscache.wms_query.app

- url: /crisismap/wms/configure_tileset
  script: wmscache.tileset_config.app

- url: /crisismap/tileworker
  script: wmscache.tileworker.app

- url: /crisismap/tileworker_cleanup
  script: wmscache.tileworker.app

- url: /crisismap/tilecache/.*
  script: wmscache.tilecache_main.app

- url: .*/remote_api
  script: google.appengine.ext.remote_api.handler.application
  login: admin

- url: /favicon.ico
  static_files: static/favicon.ico
  upload: static/favicon.ico

- url: /crisismap/static/(.*).json
  static_files: static/\1.json
  upload: static/(.*).json
  mime_type: application/json

- url: /crisismap/static
  static_dir: static

- url: /crisismap/js/compiled/(.*).js
  static_files: js/compiled/\1.js
  upload: js/compiled/(.*).js

# NOTE(cimamoglu): metadata_cleaner, metadata_scheduler and metadata_retriever
# should have login: admin for security. This is a temporary solution until we
# find out why cron jobs return with HTTP 403.
- url: /crisismap/metadata_cleaner
  script: metadata_cleaner.app

- url: /crisismap/metadata_scheduler
  script: metadata_scheduler.app
  login: admin

- url: /crisismap/metadata_retriever
  script: metadata_retriever.app

- url: /crisismap/metadata
  script: metadata.app

- url: /crisismap/jsonp
  script: jsonp.app

- url: /crisismap/api/.*
  script: api.app

- url: /crisismap/delete
  script: delete.app
  login: required

- url: /crisismap/create
  script: create.app
  login: required

- url: /crisismap/publish
  script: publish.app
  login: required

- url: /crisismap/unpublish
  script: unpublish.app
  login: required

- url: /crisismap/redirect/[\w.-]+
  script: redirect.app

- url: /crisismap/share/.*
  script: share.app
  login: required

- url: /crisismap/maps
  script: list.app
  login: required

- url: /crisismap/diff/[\w-]+
  script: diff.app

- url: /crisismap/legend/[^\s]+
  script: legend_item_extractor.app

- url: /crisismap/a/[\w.-]+
  script: catalog.app
  login: required

- url: /crisismap/maps/[\w-]+
  script: map.app

- url: /crisismap/(a/[\w.-]+/)?[\w-]+
  script: map.app

- url: (/crisismap)?/*
  script: index.app

